<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LuminaBooks - Access</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .glass-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .step-transition { transition: opacity 0.3s ease, transform 0.3s ease; }
        .tab-active { background-color: #D97706; color: white; }
        .input-style {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1rem;
            padding-right: 3rem;
            color: white;
            outline: none;
            transition: all 0.2s;
        }
        .input-style:focus {
            border-color: #D97706;
            background: rgba(255, 255, 255, 0.1);
            ring: 2px solid #D97706;
        }
        .toggle-password {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: rgba(255, 255, 255, 0.4);
            transition: color 0.2s;
        }
        .toggle-password:hover {
            color: #D97706;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-[#0F172A] p-4 bg-cover bg-center"
    style="background-image: linear-gradient(rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.85)), url('https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?q=80&w=2000');">

    <div class="glass-card w-full max-w-md rounded-[2.5rem] p-6 sm:p-10">
        <!-- Tabs -->
        <div id="tab-container" class="flex p-1 bg-white/5 rounded-2xl mb-8">
            <button id="tab-signin" class="flex-1 py-2.5 text-xs sm:text-sm font-bold rounded-xl transition-all tab-active">Sign In</button>
            <button id="tab-signup" class="flex-1 py-2.5 text-xs sm:text-sm font-bold rounded-xl transition-all text-white/60">Sign Up</button>
        </div>

        <div class="text-center mb-8">
            <h2 id="main-title" class="text-2xl sm:text-3xl font-serif text-white mb-2">Welcome Back</h2>
            <p id="main-sub" class="text-white/50 text-xs sm:text-sm px-4">Enter your credentials to access your library.</p>
        </div>

        <div id="status-msg" class="hidden mb-6 p-4 rounded-xl text-xs sm:text-sm text-center"></div>

        <!-- AUTH FORM -->
        <form id="auth-form" class="space-y-4">
            <div id="name-field" class="hidden space-y-1.5">
                <label class="text-[10px] font-semibold text-white/30 uppercase tracking-widest ml-1">Full Name</label>
                <input id="user-name" type="text" class="input-style" placeholder="John Doe">
            </div>

            <div class="space-y-1.5">
                <label class="text-[10px] font-semibold text-white/30 uppercase tracking-widest ml-1">Email Address</label>
                <input id="user-email" type="email" class="input-style" placeholder="email@example.com" required>
            </div>

            <div class="space-y-1.5">
                <label class="text-[10px] font-semibold text-white/30 uppercase tracking-widest ml-1">Password</label>
                <div class="relative">
                    <input id="user-pass" type="password" class="input-style" placeholder="••••••••" required>
                    <div id="toggle-btn" class="toggle-password">
                        <!-- Eye Icon SVG -->
                        <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                </div>
            </div>

            <button type="submit" id="submit-btn" class="w-full bg-[#D97706] hover:bg-[#B45309] text-white font-bold py-4 rounded-2xl shadow-lg transition-all mt-4">
                Sign In
            </button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // CONFIGURATION
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyCdR16dSJ9abUh-oGvZtR7WdTxY8G2taEg",
            authDomain: "ebookstore-1037b.firebaseapp.com",
            projectId: "ebookstore-1037b",
            storageBucket: "ebookstore-1037b.firebasestorage.app",
            messagingSenderId: "339448585485",
            appId: "1:339448585485:web:a6eac7fca5869c6dbea444"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'lumina-books-v1';

        let currentMode = 'signin';

        const authForm = document.getElementById('auth-form');
        const submitBtn = document.getElementById('submit-btn');
        const statusMsg = document.getElementById('status-msg');
        const nameField = document.getElementById('name-field');
        const mainTitle = document.getElementById('main-title');
        const mainSub = document.getElementById('main-sub');
        const emailInput = document.getElementById('user-email');
        const passInput = document.getElementById('user-pass');
        const nameInput = document.getElementById('user-name');
        const toggleBtn = document.getElementById('toggle-btn');
        const eyeIcon = document.getElementById('eye-icon');

        // Password Visibility Toggle
        toggleBtn.addEventListener('click', () => {
            const isPassword = passInput.type === 'password';
            passInput.type = isPassword ? 'text' : 'password';
            
            // Update Icon
            if (isPassword) {
                eyeIcon.innerHTML = `
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                `;
            } else {
                eyeIcon.innerHTML = `
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                `;
            }
        });

        function setMode(mode) {
            currentMode = mode;
            statusMsg.classList.add('hidden');
            if (mode === 'signin') {
                nameField.classList.add('hidden');
                mainTitle.innerText = "Welcome Back";
                mainSub.innerText = "Enter your credentials to access your library.";
                submitBtn.innerText = "Sign In";
                document.getElementById('tab-signin').classList.add('tab-active');
                document.getElementById('tab-signup').classList.remove('tab-active');
            } else {
                nameField.classList.remove('hidden');
                mainTitle.innerText = "Create Account";
                mainSub.innerText = "Join LuminaBooks to start your collection.";
                submitBtn.innerText = "Register Now";
                document.getElementById('tab-signup').classList.add('tab-active');
                document.getElementById('tab-signin').classList.remove('tab-active');
            }
        }

        document.getElementById('tab-signin').onclick = () => setMode('signin');
        document.getElementById('tab-signup').onclick = () => setMode('signup');

        authForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const pass = passInput.value;
            const name = nameInput.value;

            submitBtn.disabled = true;
            submitBtn.innerText = "Processing...";

            try {
                if (currentMode === 'signup') {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                    const user = userCredential.user;

                    await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'), {
                        name: name,
                        email: email,
                        createdAt: new Date().toISOString()
                    });

                    // Sign out to force manual login
                    await signOut(auth);

                    showStatus("Registration successful! Please Sign In now.", "success");
                    setMode('signin');
                    
                    emailInput.value = email;
                    passInput.value = "";
                    nameInput.value = "";
                    
                    submitBtn.disabled = false;
                    submitBtn.innerText = "Sign In";

                } else {
                    const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                    const user = userCredential.user;

                    const userDoc = await getDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'));
                    const userData = userDoc.data();
                    
                    showStatus(`Hello ${userData?.name || 'Reader'}! Redirecting to library...`, "success");
                    
                    setTimeout(() => { 
                        window.location.href = "index.html"; 
                    }, 1500);
                }

            } catch (err) {
                console.error(err);
                let message = "An error occurred.";
                if (err.code === 'auth/email-already-in-use') message = "Email already registered.";
                if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                    message = "Invalid email or password.";
                }
                if (err.code === 'auth/weak-password') message = "Password should be at least 6 characters.";
                
                showStatus(message, "error");
                submitBtn.disabled = false;
                submitBtn.innerText = currentMode === 'signup' ? "Register Now" : "Sign In";
            }
        };

        function showStatus(msg, type) {
            statusMsg.innerText = msg;
            statusMsg.className = `mb-6 p-4 rounded-xl text-center ${type === 'error' ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}`;
            statusMsg.classList.remove('hidden');
        }
    </script>
</body>
</html>