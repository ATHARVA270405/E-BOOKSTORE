<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE E-BOOK STORE | The Infinite Digital Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --brand-orange: #d97706;
            --bg-cream: #FFFCF8;
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-cream);
            color: #1e293b;
            scroll-behavior: smooth;
        }
        .font-serif { font-family: 'Crimson Pro', serif; }
        .book-card:hover { transform: translateY(-8px); }
        .glass-nav { background: rgba(255, 252, 248, 0.9); backdrop-filter: blur(16px); }
        .gradient-text { background: linear-gradient(135deg, #d97706 0%, #92400e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .badge-free { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
        .badge-paid { background: #fff7ed; color: #b45309; border: 1px solid #ffedd5; }
        
        .hero-pattern {
            background-color: #fffcf8;
            background-image: radial-gradient(#fed7aa 0.5px, transparent 0.5px);
            background-size: 24px 24px;
        }

        /* Streak Animation */
        .streak-pop {
            animation: streak-bounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes streak-bounce {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Chatbot Custom Styles */
        #chatbot-window {
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .chat-bubble-user { background: #fef3c7; border-radius: 1.25rem 1.25rem 0 1.25rem; }
        .chat-bubble-bot { background: #f1f5f9; border-radius: 1.25rem 1.25rem 1.25rem 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="overflow-x-hidden">
<script>
//   const user = localStorage.getItem("ebook_user");
//   if (!user) {
//     window.location.href = "login.html";
//   }
// </script>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-nav border-b border-orange-100">
        <div class="max-w-[1400px] mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="switchView('home')">
                <div class="p-2.5 bg-amber-600 rounded-xl group-hover:rotate-12 transition-transform shadow-lg shadow-amber-200">
                    <i data-lucide="book-open" class="text-white w-6 h-6"></i>
                </div>
                <span class="text-xl md:text-2xl font-serif font-bold tracking-tight text-slate-800">E-BOOK<span class="text-amber-600"> STORE</span></span>
            </div>
            
            <div class="hidden lg:flex items-center gap-8 text-sm font-bold tracking-wide">
                <button onclick="switchView('home')" class="text-amber-700 transition-all flex items-center gap-2">Explore</button>
                <button id="nav-library-btn" onclick="switchView('library')" class="hidden text-slate-500 hover:text-amber-600 transition-all">My Library</button>
                <button onclick="scrollToSearch()" class="text-slate-500 hover:text-amber-600 transition-all">Free Books</button>
                <button onclick="switchView('publish')" class="text-slate-500 hover:text-amber-600 transition-all">Publish</button>
                <button id="admin-nav-btn" onclick="switchView('admin')" class="hidden text-red-600 hover:text-red-700 transition-all flex items-center gap-2 px-3 py-1 bg-red-50 rounded-lg border border-red-100">
                    <i data-lucide="shield-check" class="w-4 h-4"></i> Admin Portal
                </button>
            </div>

            <div class="flex items-center gap-4">
                <!-- Streak Display -->
                <div id="streak-container" class="hidden flex items-center gap-1.5 px-3 py-1.5 bg-orange-100 text-orange-700 rounded-full border border-orange-200 streak-pop">
                    <i data-lucide="flame" class="w-4 h-4 fill-orange-500 text-orange-500"></i>
                    <span id="streak-count" class="text-sm font-black">0</span>
                </div>

                <div id="user-profile" class="hidden flex items-center gap-4 bg-orange-50/50 py-1.5 pl-4 pr-1.5 rounded-full border border-orange-100">
                    <span id="user-role-badge" class="text-slate-700 text-sm font-medium">Reader</span>
                    <button onclick="toggleAuth(false)" class="p-2 bg-white text-slate-400 hover:text-red-500 rounded-full transition-all shadow-sm">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                    </button>
                </div>
                
                <div id="auth-controls" class="flex gap-2">
                   <div id="auth-controls" class="flex gap-2 items-center">

    <!-- STREAK BUTTON -->
    <button onclick="openStreakPopup()" 
        class="flex items-center gap-1 px-4 py-2 bg-orange-100 text-orange-700 rounded-full border border-orange-200 hover:scale-105 transition">
        <i data-lucide="flame" class="w-4 h-4 text-orange-500"></i>
        <span id="nav-streak-count" class="text-sm font-bold">0</span>
    </button>

    <button onclick="window.location.href='login.html'"
        class="px-5 py-2.5 bg-slate-900 hover:bg-slate-800 text-white text-sm font-bold rounded-full transition-all shadow-lg">
        Sign In
    </button>

    <button onclick="window.location.href='admin.html'"
        class="px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-full transition-all shadow-lg">
        Admin
    </button>

</div>

                </div>
                
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <section id="hero-section" class="pt-32 pb-20 hero-pattern">
        <div class="max-w-[1400px] mx-auto px-6 grid lg:grid-cols-2 gap-12 items-center">
            <div class="space-y-8">
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-amber-50 text-amber-700 rounded-full text-xs font-bold border border-amber-100">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-amber-500"></span>
                    </span>
                    Join 50k+ readers worldwide
                </div>
                <h1 class="text-6xl md:text-7xl font-serif font-bold text-slate-900 leading-[1.1]">
                    Your Gateway to <br><span class="gradient-text">Infinite Wisdom.</span>
                </h1>
                <p class="text-lg text-slate-500 max-w-lg leading-relaxed">
                    Explore a curated collection of thousands of digital books at <strong>E-BOOK STORE</strong>. From rare classics to modern masterpieces, read for free or support authors directly.
                </p>
                <div class="flex flex-wrap gap-4 pt-4">
                    <button onclick="scrollToSearch()" class="px-8 py-4 bg-amber-600 hover:bg-slate-900 text-white font-bold rounded-2xl transition-all shadow-xl shadow-amber-200 flex items-center gap-3">
                        Browse Library <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                    <button onclick="switchView('publish')" class="px-8 py-4 bg-white border-2 border-orange-100 text-slate-800 font-bold rounded-2xl hover:bg-orange-50 transition-all">
                        Publish Your Work
                    </button>
                </div>
            </div>
            <div class="relative hidden lg:block">
                <img src="https://images.unsplash.com/photo-1512820790803-83ca734da794?q=80&w=800" class="relative z-10 rounded-[3rem] shadow-2xl rotate-2 hover:rotate-0 transition-transform duration-700" alt="Library">
            </div>
        </div>
    </section>

    <main class="max-w-[1400px] mx-auto px-6 pb-32">
        <!-- HOME VIEW -->
        <div id="home-view">
            <div class="flex flex-col lg:flex-row gap-10 mt-12">
                <aside class="lg:w-64 flex-shrink-0">
                    <div class="sticky top-28 space-y-8">
                        <div>
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                                <i data-lucide="filter" class="w-[14px] h-[14px]"></i> Pricing Model
                            </h3>
                            <div class="flex flex-col gap-2 mb-8">
                                <button onclick="setAccessFilter('all')" id="filter-all" class="text-left px-4 py-2.5 rounded-xl text-sm font-bold bg-amber-600 text-white shadow-md">Everything</button>
                                <button onclick="setAccessFilter('free')" id="filter-free" class="text-left px-4 py-2.5 rounded-xl text-sm font-bold text-slate-600 hover:bg-orange-50">Free Access</button>
                                <button onclick="setAccessFilter('paid')" id="filter-paid" class="text-left px-4 py-2.5 rounded-xl text-sm font-bold text-slate-600 hover:bg-orange-50">Premium (‚Çπ)</button>
                            </div>

                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                                <i data-lucide="grid" class="w-[14px] h-[14px]"></i> Genre
                            </h3>
                            <div id="category-list" class="space-y-1"></div>
                        </div>
                    </div>
                </aside>

                <div class="flex-grow">
                    <div id="search-anchor" class="mb-12 scroll-mt-28">
                        <form onsubmit="handleSearch(event)" class="relative group">
                            <i data-lucide="search" class="absolute left-8 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-amber-600 transition-colors"></i>
                            <input id="search-input" type="text" placeholder="Search by title, author or ISBN..." 
                                class="w-full h-20 pl-20 pr-40 bg-white border border-orange-100 rounded-[2.5rem] shadow-xl shadow-orange-100/20 focus:outline-none focus:ring-4 focus:ring-amber-50 transition-all text-lg"
                            />
                            <button type="submit" class="absolute right-3 top-3 bottom-3 px-10 bg-slate-900 hover:bg-amber-700 text-white font-bold rounded-[2rem] transition-all">Search</button>
                        </form>
                    </div>

                    <div id="loading-state" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                        <div class="animate-pulse bg-orange-50/50 aspect-[3/4.2] rounded-[2.5rem]"></div>
                        <div class="animate-pulse bg-orange-50/50 aspect-[3/4.2] rounded-[2.5rem]"></div>
                    </div>

                    <div id="book-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>

                    <div id="load-more-container" class="flex justify-center pt-16">
                        <button id="load-more-btn" onclick="loadMore()" class="group flex items-center gap-3 px-12 py-5 bg-white border-2 border-orange-100 text-slate-800 font-bold rounded-[2rem] hover:bg-slate-900 hover:text-white transition-all shadow-sm">
                            <i data-lucide="chevron-down" class="group-hover:translate-y-1 transition-transform"></i> Load More Results
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LIBRARY VIEW -->
        <div id="library-view" class="hidden space-y-12 py-12 pt-28">
            <div class="flex justify-between items-end">
                <h1 class="text-5xl font-serif font-bold text-slate-900">Personal Shelf</h1>
                <div class="p-6 bg-white border border-orange-100 rounded-3xl flex items-center gap-4 shadow-sm">
                    <div class="w-12 h-12 bg-orange-50 rounded-2xl flex items-center justify-center">
                        <i data-lucide="flame" class="text-orange-600"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Reading Streak</p>
                        <p class="text-2xl font-black text-slate-900"><span id="lib-streak-val">0</span> Days</p>
                    </div>
                </div>
            </div>
            <div id="saved-books-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-8"></div>
        </div>

        <!-- PUBLISH VIEW -->


      <div id="publish-view" class="hidden max-w-6xl mx-auto py-12 pt-28">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

    <!-- LEFT: PUBLISH FORM -->
    <div class="lg:col-span-2 bg-white border border-orange-100 rounded-[3rem] p-12 shadow-2xl">
      <h1 class="text-4xl font-serif font-bold mb-6">Author Portal</h1>
      <p class="text-slate-500 mb-10 text-lg">
        Submit your manuscript for review. Our editors will verify the quality before listing it on
        <strong>THE E-BOOK STORE</strong>.
      </p>

      <form onsubmit="handlePublish(event)" class="space-y-10">

        <!-- TITLE + LISTING -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

          <!-- BOOK TITLE -->
          <div class="space-y-2">
            <label class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-2">
              Book Title
            </label>
            <input
              type="text"
              placeholder="e.g. The Midnight Sun"
              required
              class="w-full bg-orange-50/30 border border-orange-100 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-amber-500/20"
            >
          </div>

          <!-- PREFERRED LISTING -->
          <div class="space-y-2">
            <label class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-2">
              Preferred Listing
            </label>
            <select
              id="listingType"
              onchange="togglePriceField()"
              class="w-full bg-orange-50/30 border border-orange-100 rounded-2xl px-6 py-4 outline-none"
            >
              <option value="Free">List for Free</option>
              <option value="Paid">Premium (‚Çπ)</option>
            </select>
          </div>

          <!-- PRICE FIELD -->
          <div id="priceField" class="space-y-2 hidden">
            <label class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-2">
              Book Price (‚Çπ)
            </label>
            <input
              id="bookPrice"
              type="number"
              min="1"
              placeholder="Enter price in rupees"
              class="w-full bg-orange-50/30 border border-orange-100 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-amber-500/20"
            >
          </div>
        </div>

        <!-- PDF UPLOAD -->
        <div class="space-y-3">
          <label class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-2">
            Manuscript (PDF)
          </label>
          <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-orange-200 rounded-3xl cursor-pointer bg-orange-50/20 hover:bg-orange-50 transition">
            <input type="file" accept="application/pdf" required class="hidden">
            <span class="text-lg font-semibold text-slate-700">Upload PDF File</span>
            <span class="text-sm text-slate-400 mt-1">Only PDF ‚Ä¢ Max 20MB</span>
          </label>
        </div>

        <!-- COVER IMAGE -->
        <div class="space-y-3">
          <label class="text-xs font-bold uppercase tracking-widest text-slate-400 ml-2">
            Cover Image
          </label>
          <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-orange-200 rounded-3xl cursor-pointer bg-orange-50/20 hover:bg-orange-50 transition">
            <input type="file" accept="image/*" required class="hidden">
            <span class="text-lg font-semibold text-slate-700">Upload Cover Image</span>
            <span class="text-sm text-slate-400 mt-1">JPG / PNG ‚Ä¢ Recommended 1600√ó2400</span>
          </label>
        </div>

        <!-- SUBMIT -->
        <button
          type="submit"
          class="w-full py-5 bg-slate-900 text-white font-bold rounded-2xl hover:bg-amber-600 transition-all shadow-xl shadow-slate-200"
        >
          Submit Work for Review
        </button>

      </form>
    </div>

    <!-- RIGHT: VIEW PUBLISHED BOOKS PANEL -->
   <!-- RIGHT: MATCHING SIZE PANEL -->
<div
  onclick="window.location.href='author.html'"
  class="cursor-pointer bg-white border border-orange-100 rounded-[3rem] p-12 shadow-2xl hover:shadow-amber-200 transition-all h-full flex flex-col justify-between"
>
  <div>
    <h2 class="text-4xl font-serif font-bold mb-6 text-slate-900">
      Your Published Books
    </h2>

    <p class="text-slate-500 text-lg leading-relaxed">
      View, manage, and track all your submitted and published books in one place.
    </p>
  </div>

  <div class="pt-10">
    <span class="inline-flex items-center gap-3 text-amber-600 font-bold text-lg">
      View All Books ‚Üí
    </span>
  </div>
</div>


<script>
  function togglePriceField() {
    const listingType = document.getElementById("listingType").value;
    const priceField = document.getElementById("priceField");
    const priceInput = document.getElementById("bookPrice");

    if (listingType === "Paid") {
      priceField.classList.remove("hidden");
      priceInput.required = true;
    } else {
      priceField.classList.add("hidden");
      priceInput.required = false;
      priceInput.value = "";
    }
  }
</script>




        <!-- ADMIN VIEW -->
        <div id="admin-view" class="hidden py-12 pt-28">
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white border border-red-100 rounded-[2.5rem] p-8 shadow-xl">
                        <h2 class="text-2xl font-serif font-bold mb-6">Database Stats</h2>
                        <div class="space-y-4">
                            <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                <p class="text-xs font-bold text-slate-400 uppercase">Manual Entries</p>
                                <p id="stat-manual-count" class="text-3xl font-bold text-slate-900">0</p>
                            </div>
                            <div class="p-4 bg-red-50 rounded-2xl border border-red-100">
                                <p class="text-xs font-bold text-red-400 uppercase">Pending Review</p>
                                <p class="text-3xl font-bold text-red-600">12</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border border-slate-100 rounded-[2.5rem] p-8 shadow-xl overflow-hidden">
                        <h3 class="text-lg font-bold mb-4">Preview Card</h3>
                        <div id="admin-preview-container" class="scale-90 -origin-top transform">
                             <div class="text-center py-20 text-slate-300 italic text-sm">Fill form to see preview</div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-8">
                    <div class="bg-white border-2 border-slate-900 rounded-[3rem] p-10 shadow-2xl relative overflow-hidden">
                        <div class="flex justify-between items-start mb-10">
                            <div>
                                <h1 class="text-4xl font-serif font-bold text-slate-900">Add New eBook</h1>
                                <p class="text-slate-500 mt-2">Create a manual entry for the library database.</p>
                            </div>
                            <div class="p-4 bg-slate-900 text-white rounded-2xl">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </div>
                        </div>

                        <form onsubmit="handleAdminManualAdd(event)" id="admin-manual-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 ml-2">Book Title</label>
                                    <input id="admin-title" oninput="updateAdminPreview()" type="text" class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 outline-none focus:border-slate-900" placeholder="e.g. Beyond the Horizon" required>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 ml-2">Author Name</label>
                                    <input id="admin-author" oninput="updateAdminPreview()" type="text" class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 outline-none focus:border-slate-900" placeholder="e.g. Dr. Jane Smith" required>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 ml-2">Cover Image URL</label>
                                    <input id="admin-cover" oninput="updateAdminPreview()" type="url" class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 outline-none focus:border-slate-900" placeholder="https://images.unsplash.com/...">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-400 ml-2">Price Category</label>
                                    <select id="admin-type" onchange="updateAdminPreview()" class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 outline-none focus:border-slate-900">
                                        <option value="Free">Free Listing</option>
                                        <option value="Paid">Premium (Paid)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 ml-2">Description / Blurb</label>
                                <textarea id="admin-desc" class="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 outline-none focus:border-slate-900 h-32 resize-none" placeholder="Enter a brief summary of the book..."></textarea>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="w-full py-5 bg-slate-900 text-white font-bold rounded-2xl hover:bg-amber-600 transition-all shadow-xl shadow-slate-200 flex items-center justify-center gap-3 group">
                                    Confirm & Publish to Library <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="bg-white border border-slate-100 rounded-[2.5rem] p-8 shadow-lg">
                        <h3 class="text-xl font-bold mb-6">Recent Manual Entries</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="border-b border-slate-100">
                                    <tr>
                                        <th class="pb-4 text-xs font-bold text-slate-400 uppercase px-2">Book</th>
                                        <th class="pb-4 text-xs font-bold text-slate-400 uppercase px-2">Author</th>
                                        <th class="pb-4 text-xs font-bold text-slate-400 uppercase px-2">Type</th>
                                        <th class="pb-4 text-xs font-bold text-slate-400 uppercase px-2 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-recent-list" class="divide-y divide-slate-50"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-slate-900 text-white py-20">
        <div class="max-w-[1400px] mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
            <div>
                <span class="text-2xl font-serif font-bold mb-4 block">THE <span class="text-amber-500">E-BOOK STORE</span></span>
                <p class="text-slate-400">The world's largest open-access library project for high-quality digital literature.</p>
            </div>
            <div>
                <h4 class="font-bold mb-6 text-amber-500">Resources</h4>
                <ul class="space-y-4 text-slate-400 text-sm">
                    <li class="hover:text-white cursor-pointer transition-colors">Open API</li>
                    <li class="hover:text-white cursor-pointer transition-colors">Author Guidelines</li>
                    <li class="hover:text-white cursor-pointer transition-colors">DMCA Policy</li>
                </ul>
            </div>
        </div>
    </footer>

    <!-- CHATBOT -->
    <div class="fixed bottom-6 right-6 z-[1000] flex flex-col items-end">
        <div id="chatbot-window" class="hidden w-[350px] sm:w-[400px] h-[500px] bg-white rounded-[2.5rem] border border-orange-100 flex flex-col overflow-hidden mb-4 origin-bottom-right">
            <div class="bg-amber-600 p-6 text-white flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                        <i data-lucide="bot" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm leading-none">Assistant</h4>
                        <span class="text-[10px] text-amber-100 uppercase tracking-widest font-bold">Online Now</span>
                    </div>
                </div>
                <button onclick="toggleChatbot()" class="p-2 hover:bg-black/10 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="chat-messages" class="flex-grow p-6 overflow-y-auto custom-scrollbar flex flex-col gap-4">
                <div class="chat-bubble-bot p-4 text-sm text-slate-700 max-w-[85%] self-start">
                    Hello! Welcome to <strong>THE E-BOOK STORE</strong>. How can I help you explore our library today?
                </div>
            </div>
            <div id="chat-suggestions" class="px-6 py-2 flex gap-2 overflow-x-auto custom-scrollbar no-scrollbar">
                <button onclick="sendQuickMsg('Show me free books')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-amber-700 text-xs font-bold rounded-full border border-orange-100 hover:bg-orange-100 transition-colors">Free Books</button>
                <button onclick="sendQuickMsg('How to publish?')" class="whitespace-nowrap px-3 py-1.5 bg-orange-50 text-amber-700 text-xs font-bold rounded-full border border-orange-100 hover:bg-orange-100 transition-colors">Publishing</button>
            </div>
            <form onsubmit="handleChatSubmit(event)" class="p-4 border-t border-slate-100 flex gap-2">
                <input id="chat-input" type="text" placeholder="Ask me anything..." class="flex-grow bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-amber-50 outline-none">
                <button type="submit" class="bg-amber-600 text-white p-3 rounded-xl hover:bg-slate-900 transition-colors">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </button>
            </form>
        </div>
        <button onclick="toggleChatbot()" class="w-16 h-16 bg-amber-600 text-white rounded-full flex items-center justify-center shadow-2xl shadow-amber-200 hover:scale-110 transition-transform active:scale-95">
            <i data-lucide="message-circle" id="chat-icon-open" class="w-8 h-8"></i>
            <i data-lucide="chevron-down" id="chat-icon-close" class="hidden w-8 h-8"></i>
        </button>
    </div>

    <!-- Modals & Toasts -->
    <div id="contact-modal" class="hidden fixed inset-0 z-[500] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm" onclick="closeContactModal()"></div>
        <div class="relative bg-white w-full max-w-lg rounded-[3rem] p-12 shadow-2xl">
            <h2 class="text-3xl font-serif font-bold text-slate-900 mb-4">Inquiry</h2>
            <p id="inquiry-title" class="text-slate-500 mb-6"></p>
            <form onsubmit="handleContactAdmin(event)" class="space-y-4">
                <input type="text" placeholder="Name" class="w-full bg-orange-50 rounded-2xl px-6 py-4 outline-none border border-orange-100">
                <button type="submit" class="w-full py-5 bg-amber-600 text-white font-bold rounded-2xl">Submit</button>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[1100] translate-y-20 opacity-0 transition-all bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 shadow-2xl">
        <i data-lucide="check" class="text-amber-500 w-5 h-5"></i>
        <span id="toast-msg">Success</span>
    </div>

    <!-- STREAK POPUP -->
<div id="streak-popup" class="hidden fixed inset-0 z-[1200] flex items-center justify-center">

    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeStreakPopup()"></div>

    <div class="relative bg-white max-w-md w-full rounded-[3rem] p-10 shadow-2xl streak-pop">

        <div class="flex items-center gap-4 mb-6">
            <div class="w-14 h-14 bg-orange-100 rounded-2xl flex items-center justify-center">
                <i data-lucide="flame" class="w-7 h-7 text-orange-500"></i>
            </div>
            <div>
                <p class="text-xs font-bold uppercase text-slate-400">Reading Streak</p>
                <p class="text-3xl font-black text-slate-900">
                    <span id="popup-streak-count">0</span> Days
                </p>
            </div>
        </div>

        <div class="bg-orange-50 border border-orange-100 rounded-2xl p-5 mb-6">
            <p class="text-slate-700 font-semibold text-center">
                üéÅ Complete <span class="font-black text-orange-600">20 Streaks</span><br>
                & Get <span class="font-black">1 Paid Book FREE</span>
            </p>
        </div>

        <button onclick="goToFreePaidBooks()"
            class="w-full py-4 bg-slate-900 text-white font-bold rounded-2xl hover:bg-amber-600 transition-all">
            Go to Free Paid Books ‚Üí
        </button>

    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdR16dSJ9abUh-oGvZtR7WdTxY8G2taEg",
  authDomain: "ebookstore-1037b.firebaseapp.com",
  projectId: "ebookstore-1037b",
  storageBucket: "ebookstore-1037b.firebasestorage.app",
  messagingSenderId: "339448585485",
  appId: "1:339448585485:web:a6eac7fca5869c6dbea444"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = "lumina-books-v1";

// üî• THIS IS THE MAGIC
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // USER LOGGED IN
    currentUser = { uid: user.uid };

    document.getElementById('auth-controls').classList.add('hidden');
    document.getElementById('user-profile').classList.remove('hidden');
    document.getElementById('nav-library-btn').classList.remove('hidden');

    // Fetch user profile
    const snap = await getDoc(
      doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data')
    );

    const userData = snap.exists() ? snap.data() : {};
    document.getElementById('user-role-badge').innerText = userData.name || "Reader";

  } else {
    // USER LOGGED OUT
    currentUser = null;

    document.getElementById('user-profile').classList.add('hidden');
    document.getElementById('auth-controls').classList.remove('hidden');
    document.getElementById('nav-library-btn').classList.add('hidden');
    document.getElementById('admin-nav-btn').classList.add('hidden');
  }
});

// LOGOUT
window.firebaseLogout = async () => {
  await signOut(auth);
  showToast("Signed out");
};
</script>



<script src="script.js"></script>

  
</body>
</html>